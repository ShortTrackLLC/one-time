<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>One Time Password (TOTP and HOTP) library for Clojure.</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">One-time</span> <span class="project-version">0.8.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1  current"><a href="README.html"><div class="inner"><span>One Time Password (TOTP and HOTP) library for Clojure.</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>one-time</span></div></div></li><li class="depth-2 branch"><a href="one-time.codec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codec</span></div></a></li><li class="depth-2 branch"><a href="one-time.core.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></a></li><li class="depth-2 branch"><a href="one-time.hotp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hotp</span></div></a></li><li class="depth-2 branch"><a href="one-time.qrgen.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>qrgen</span></div></a></li><li class="depth-2 branch"><a href="one-time.totp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>totp</span></div></a></li><li class="depth-2 branch"><a href="one-time.uri.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>uri</span></div></a></li><li class="depth-2"><a href="one-time.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#one-time-password-totp-and-hotp-library-for-clojure" id="one-time-password-totp-and-hotp-library-for-clojure"></a>One Time Password (TOTP and HOTP) library for Clojure.</h1>
<p><a href="https://github.com/suvash/one-time/actions/workflows/clojure.yml?query=branch%3Amain"><img src="https://github.com/suvash/one-time/actions/workflows/clojure.yml/badge.svg" alt="Clojure CI" /></a> <a href="https://clojars.org/one-time"><img src="https://img.shields.io/clojars/v/one-time.svg" alt="Clojars Project" /></a></p>
<p>A Clojure library for generating one time passwords (HOTP &amp; TOTP) as per <a href="http://tools.ietf.org/html/rfc4226">RFC 4226</a> and <a href="http://tools.ietf.org/html/rfc6238">RFC 6238</a>. One time passwords are used by a lot of websites for <a href="https://www.youtube.com/watch?v=17rykTIX_HY">multi factor / two factor authentication</a>. You can find a list of such websites <a href="https://twofactorauth.org">here</a>.</p>
<p>This library has been tested to be compatible with : * <a href="https://github.com/google/google-authenticator">Google Authenticator</a> for <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2">Android</a> and <a href="https://itunes.apple.com/en/app/google-authenticator/id388497605">iPhone</a> - <a href="https://www.authy.com">Authy</a> for <a href="https://play.google.com/store/apps/details?id=com.authy.authy">Android</a> and <a href="https://itunes.apple.com/en/app/authy/id494168017">iPhone</a> - <a href="https://lastpass.com/auth/">Lastpass Authenticator</a> for <a href="https://play.google.com/store/apps/details?id=com.authy.authy">Android</a> and <a href="https://itunes.apple.com/us/app/lastpass-authenticator/id1079110004">iPhone</a></p>
<h2><a href="#project-maturity" id="project-maturity"></a>Project Maturity</h2>
<p>One-Time is a feature complete and fairly stable library, given the small surface area of it’s intent. Bugfixes and dependency updates will be made as required.</p>
<h2><a href="#installation" id="installation"></a>Installation</h2>
<h3><a href="#leiningen" id="leiningen"></a>Leiningen:</h3>
<p>Add the following to your <code>:dependencies</code> in <code>project.clj</code>.</p>
<pre><code>[one-time "0.8.0"]
</code></pre>
<h3><a href="#maven" id="maven"></a>Maven</h3>
<p>Make sure to add Clojars to your <code>pom.xml</code>:</p>
<pre><code class="language-xml">&lt;repository&gt;
  &lt;id&gt;clojars.org&lt;/id&gt;
  &lt;url&gt;http://clojars.org/repo&lt;/url&gt;
&lt;/repository&gt;
</code></pre>
<p>Then add the following to Maven dependencies.</p>
<pre><code>&lt;dependency&gt;
  &lt;groupId&gt;one-time&lt;/groupId&gt;
  &lt;artifactId&gt;one-time&lt;/artifactId&gt;
  &lt;version&gt;0.8.0&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<h3><a href="#gradle" id="gradle"></a>Gradle</h3>
<pre><code>compile "one-time:one-time:0.8.0"
</code></pre>
<h2><a href="#documentation" id="documentation"></a>Documentation</h2>
<p>The frequently used functions (with industry-standard defaults) are present in the <code>one-time.core</code> namespace. However, they build on functions present in other namespaces which can always be overridden or extended as needed. Documentation on functions in individual namespaces (for the latest release) is available at <a href="https://suvash.github.io/one-time/">https://suvash.github.io/one-time/</a></p>
<h3><a href="#secret-key-generation" id="secret-key-generation"></a>Secret Key Generation</h3>
<p>Secret key generation is the first step in being able to use TOTP/HOTP. A function is provided by <code>one-time.core</code> namespace that generates random secret keys compatible with Google Authenticator, Authy and Lastpass Authenticator.</p>
<pre><code class="language-clojure">(require '[one-time.core :as ot])

(ot/generate-secret-key)
;= "Z3YMI77OFLQBPNT6"
</code></pre>
<h3><a href="#time-based-one-time-passwords-totp" id="time-based-one-time-passwords-totp"></a>Time based One-time passwords (TOTP)</h3>
<p>TOTP is based on HOTP with a timestamp replacing the incrementing counter. <code>one-time.core</code> namespace provides two functions for working with TOTP, one for getting the TOTP token at a certain time and a predicate function for verifying.</p>
<p>You’re most likely to use the predicate function for verifying tokens that you receive from the user (Google Authenticator/Authy/Lastpass Authenticator)</p>
<pre><code class="language-clojure">(require '[one-time.core :as ot])

;; Generate the key first
(def secret-key (ot/generate-secret-key))

;; At current time
(ot/get-totp-token secret-key)
;= 885510 - this will be different on your machine as it's based on time

;; Verify at current time and after 30 seconds
;; arguments are token-received, secret-key
(def current-token (ot/get-totp-token secret-key))
(ot/is-valid-totp-token? current-token secret-key)
;= true

;; Wait 30 secs
(Thread/sleep 30000)

;; Verify after 30 secs
;; arguments are token-received, secret-key
(ot/is-valid-totp-token? current-token secret-key)
;= false

;; Verify for the last time step offset, eg. support clock drifts
;; arguments are token-received, secret-key, time-step-offset
(ot/is-valid-totp-token? current-token secret-key {:time-step-offset -1})
;= true
</code></pre>
<p>The functions above also accept additional map by which various aspects of TOTP token generation is affected. One can configure them to accept a specific time (instead of current time), a different time step (default 30 secs), a time step offset to support clock drifts (default current time step), and a different HMAC SHA function (instead of HMAC-SHA-1). Feel free to look more into <code>one-time.core</code> and <code>one-time.totp</code> namespace to configure these.</p>
<h3><a href="#hmac-based-one-time-passwords-hotp" id="hmac-based-one-time-passwords-hotp"></a>HMAC based One-time passwords (HOTP)</h3>
<p>HOTP is also better understood as counter based OTP. <code>one-time.core</code> namespace provides two functions for working with HOTP, one for getting the HOTP token at a certain counter and a predicate function for verifying.</p>
<p>You’re most likely to use the predicate function for verifying tokens that you receive from the user. HOTP is not supported by Google Authenticator, Authy or Lastpass Authenticator. (They all support TOTP.)</p>
<pre><code class="language-clojure">(require '[one-time.core :as ot])

;; Generate the key first, in this example i'll pick one
(def secret-key "HZSRH7AWHI6JV427")

;; At counter 1
(ot/get-hotp-token secret-key 1)
;= 817667

;; At counter 478
(ot/get-hotp-token secret-key 478)
;= 793369

;; Verify at counter 1567
;; arguments are token-received, secret-key, counter
(ot/is-valid-hotp-token? 446789 secret-key 1567)
;= false

;; Verify at counter 23456
;; arguments are token-received, secret-key, counter
(ot/is-valid-hotp-token? 13085 secret-key 23456)
;= true
</code></pre>
<h3><a href="#totphotp-uri-generation" id="totphotp-uri-generation"></a>TOTP/HOTP URI generation</h3>
<p><code>one-time.uri</code> namespace provides additional functions for generating TOTP and HOTP URIs which can be further embed in QR codes to present to the user. A map is used to configure the URI generation functions.</p>
<pre><code class="language-clojure">(require '[one-time.uri  :as oturi])

;; Generate the key first, in this example i'll pick one
(def secret-key "NBCVJLJHRKQEYLAD")

;; TOTP URI generation function accepts a map with following keys (non-optional) to generate the URI
;; :label  = Company.com ---- Name of the secret issuing firm, usually the company name
;; :user   = user@email.com - Name of the user intended to use the secret, usually the email address
;; :secret = secret key " --- Secret Key needed to be used
;;
;;
(oturi/totp-uri {:label "Company.com" :user "user@email.com" :secret secret-key})
;= "otpauth://totp/Company.com:user%40email.com?secret=NBCVJLJHRKQEYLAD&amp;issuer=Company.com"

;; HOTP URI generation function accepts a map with following keys (non-optional) to generate the URI
;; :label  = Company.com ---- Name of the secret issuing firm, usually the company name
;; :user   = user@email.com - Name of the user intended to use the secret, usually the email address
;; :secret = secret key " --- Secret Key needed to be used
;; :counter = 123456 -------- Counter need to be used for HOTP
;;
(oturi/hotp-uri {:label "Company.com" :user "user@email.com" :secret secret-key :counter 123456})
;= "otpauth://hotp/Company.com:user%40email.com?secret=NBCVJLJHRKQEYLAD&amp;issuer=Company.com&amp;counter=123456"
</code></pre>
<p>The URIs generated above can then be embedded into QR codes that can be displayed to user.</p>
<h3><a href="#working-example" id="working-example"></a>Working Example</h3>
<p>Scan the following barcode with your phone, using Google Authenticator, Authy or Lastpass Authenticator.</p>
<p><img src="https://chart.googleapis.com/chart?chs=200x200&amp;cht=qr&amp;chl=otpauth%3A%2F%2Ftotp%2FCompany.com%3Auser%2540email.com%3Fsecret%3DTA4WPSAGBMGXLFVI%26issuer%3DCompany.com" alt="QR Code for TOTP" /></p>
<p>Run the following in a REPL and compare the values on the REPL and your device. Make sure you don’t have any clock drifts etc., especially if you’re running it inside a VM/container.</p>
<pre><code class="language-clojure">(require '[one-time.core :as ot])

;; Use the same secret key as the bar code
(def secret-key "TA4WPSAGBMGXLFVI")

;; Compare these values to the one you get on your device at the same time
(ot/get-totp-token secret-key)
</code></pre>
<h3><a href="#qr-code-image-generation" id="qr-code-image-generation"></a>QR Code Image Generation</h3>
<p>This library wraps over <a href="https://github.com/kenglxn/QRGen">https://github.com/kenglxn/QRGen</a>, to generate QR code images locally. The generated image can be read as a <code>java.io.File</code> or over a <code>java.io.ByteArrayoutputstream</code>. Optionally, image type (BMP,JPG,PNG,GIF) and image size can be provided.</p>
<pre><code class="language-clojure">(require '[one-time.qrgen :as qrgen])

;; Generate the key first, in this example i'll pick one
(def secret-key "HTWU5NFLBMWY2MQS")

;; TOTP QRcode image file generation, default image size(125px square) and type(JPG)
(def qrcode-file (qrgen/totp-file {:image-type :BMP :label "company.org" :user "user@gmail.com" :secret secret}))

;; TOTP QRcode image stream generation, in GIF
(def qrcode-stream (qrgen/totp-stream {:image-type :GIF :label "company.org" :user "user@gmail.com" :secret secret}))

;; HOTP QRcode image file generation, 300px square in PNG
(def qrcode-file (qrgen/hotp-file {:image-type :PNG :image-size 300 :label "company.org" :user "user@gmail.com" :secret secret :counter 123}))

;; HOTP QRcode image stream generation
(def qrcode-stream (qrgen/hotp-stream {:label "company.org" :user "user@gmail.com" :secret secret :counter 123}))
</code></pre>
<h2><a href="#supported-clojure-versions" id="supported-clojure-versions"></a>Supported Clojure Versions</h2>
<p>One-Time has been tested to work against Clojure 1.6 and up. The most recent release is always recommended.</p>
<h2><a href="#development" id="development"></a>Development</h2>
<p>If you already have Leiningen on your machine, you should just be able to run <code>lein all test</code> as you would do on other leiningen projects.</p>
<p>As prefered by the author, you can also use the provided Makefile to run the tests. In that case, you’ll need the following on your machine - GNU Make ( Version 4.0 and up ) - <a href="https://docs.docker.com/engine/installation/">Docker Engine</a> ( Version 17.06.1 and hopefully upwards ) - <a href="https://github.com/docker/compose/releases">Docker Compose</a> ( Version 1.16.1 and hopefully upwards )</p>
<pre><code># Get help
$ make help

# Run tests
$ make test

# Stop and cleanup docker instances etc.
# make stop-clean
</code></pre>
<p>Then create a branch and make your changes on it. Once you are done with your changes and all tests pass, submit a pull request on GitHub.</p>
<h2><a href="#changelog" id="changelog"></a>Changelog</h2>
<p>Please check the <a href="https://github.com/suvash/one-time/blob/master/CHANGELOG.md">CHANGELOG.md</a> graph for now.</p>
<h2><a href="#contributors" id="contributors"></a>Contributors</h2>
<p>Please check the <a href="https://github.com/suvash/one-time/graphs/contributors">contribution graph</a> graph for now.</p>
<h2><a href="#references" id="references"></a>References</h2>
<p>These resources were invaluable towards developing this library.</p>
<ul>
<li><a href="https://github.com/djui/clj-otp">https://github.com/djui/clj-otp</a></li>
<li><a href="http://nakkaya.com/2012/08/13/google-hotp-totp-two-factor-authentication-for-clojure/">http://nakkaya.com/2012/08/13/google-hotp-totp-two-factor-authentication-for-clojure/</a></li>
</ul>
<h2><a href="#license" id="license"></a>License</h2>
<p>Copyright © 2019 Suvash Thapaliya</p>
<p>Distributed under the <a href="https://github.com/suvash/one-time/blob/master/LICENSE">Eclipse Public License</a>.</p>
</div></div></div></body></html>